{{- $item := .item -}}
{{- if not $item -}}
  {{- return -}}
{{- end -}}

{{- $cardID := "" -}}
{{- with $item.File -}}
  {{- $cardID = printf "outline-%s" .UniqueID -}}
{{- else -}}
  {{- $cardID = printf "outline-%s" (anchorize $item.Title) -}}
{{- end -}}

{{- $goals := slice -}}
{{- with $item.Params.goals -}}
  {{- $goals = . -}}
{{- end -}}

{{- $meta := slice -}}
{{- with $item.Params.instructor -}}
  {{- $meta = $meta | append (printf "담당: %s" (. | plainify)) -}}
{{- end -}}

<article class="outline-card" role="article" aria-labelledby="{{ $cardID }}">
  <a class="outline-card__link" href="{{ $item.RelPermalink }}">
    <header class="outline-card__header">
      <h3 id="{{ $cardID }}" class="outline-card__title">
        {{ $item.Title }}
      </h3>
      {{- if gt (len $meta) 0 }}
        <p class="outline-card__meta">
          {{ delimit $meta " · " }}
        </p>
      {{- end }}
    </header>

    {{- if gt (len $goals) 0 }}
      <div class="outline-card__section">
        <span class="outline-card__section-title">강의 목표</span>
        <ul class="outline-card__goals">
          {{- range first 1 $goals }}
            {{- $goalOriginal := . | markdownify | plainify | strings.TrimSpace -}}
            {{- $goalText := $goalOriginal -}}
            {{- $goalText = replaceRE `(?i)^goal\s*[0-9]+[️⃣]*\s*[:：\-–—\.]*\s*` "" $goalText -}}
            {{- $goalText = replaceRE `^[0-9①②③④⑤⑥⑦⑧⑨⑩]+[\.\)\-–—：:\s]*` "" $goalText -}}
            {{- $goalText = replaceRE `^[\p{Z}\p{P}\p{S}]*` "" $goalText -}}
            {{- if eq $goalText "" }}
              {{- $goalText = $goalOriginal -}}
            {{- end }}
            {{- if ne $goalText "" }}
              <li class="outline-card__goal" title="{{ $goalText | htmlEscape }}">
                <span aria-hidden="true" class="outline-card__goal-icon">✅</span>
                <span class="outline-card__goal-text">{{ $goalText }}</span>
                <span aria-hidden="true" class="outline-card__goal-more">… 더보기</span>
              </li>
            {{- end }}
          {{- end }}
        </ul>
      </div>
    {{- end }}

    <span class="outline-card__cta">
      과목 상세 보기
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M5 12h14M13 6l6 6-6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
      </svg>
    </span>
  </a>
</article>
